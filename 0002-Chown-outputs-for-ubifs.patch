From 7b91203e13d576e0535e08657105ff946175230b Mon Sep 17 00:00:00 2001
From: Anton Mikanovich <amikan@ilbers.de>
Date: Mon, 19 Apr 2021 14:20:16 +0200
Subject: [PATCH 2/2] Chown outputs for ubifs

---
 meta/classes/fit-img.bbclass   | 1 +
 meta/classes/ubi-img.bbclass   | 1 +
 meta/classes/ubifs-img.bbclass | 1 +
 3 files changed, 3 insertions(+)

diff --git a/meta/classes/fit-img.bbclass b/meta/classes/fit-img.bbclass
index 221ac3f..82b96d8 100644
--- a/meta/classes/fit-img.bbclass
+++ b/meta/classes/fit-img.bbclass
@@ -23,5 +23,6 @@ do_fit_image() {
     # Create fit image using buildchroot tools
     sudo chroot ${BUILDCHROOT_DIR} /usr/bin/mkimage ${MKIMAGE_ARGS} \
                 -f '${PP_WORK}/${FIT_IMAGE_SOURCE}' '${PP_DEPLOY}/${FIT_IMAGE_FILE}'
+    sudo chown $(id -u):$(id -g) '${DEPLOY_DIR_IMAGE}/${FIT_IMAGE_FILE}'
 }
 addtask fit_image before do_image after do_image_tools do_transform_template
diff --git a/meta/classes/ubi-img.bbclass b/meta/classes/ubi-img.bbclass
index 2178b50..c69ac4d 100644
--- a/meta/classes/ubi-img.bbclass
+++ b/meta/classes/ubi-img.bbclass
@@ -26,5 +26,6 @@ do_ubi_image() {
     # Create ubi image using buildchroot tools
     sudo chroot ${BUILDCHROOT_DIR} /usr/sbin/ubinize ${UBINIZE_ARGS} \
                 -o '${PP_DEPLOY}/${UBI_IMAGE_FILE}' '${PP_WORK}/${UBINIZE_CFG}'
+    sudo chown $(id -u):$(id -g) '${DEPLOY_DIR_IMAGE}/${UBI_IMAGE_FILE}'
 }
 addtask ubi_image before do_image after do_image_tools do_transform_template
diff --git a/meta/classes/ubifs-img.bbclass b/meta/classes/ubifs-img.bbclass
index b14b2a8..193479a 100644
--- a/meta/classes/ubifs-img.bbclass
+++ b/meta/classes/ubifs-img.bbclass
@@ -21,6 +21,7 @@ do_ubifs_image() {
     # Create ubifs image
     # Buildchroot is not using here because of upstream issue on 32-bit platforms
     sudo mkfs.ubifs ${MKUBIFS_ARGS} -r '${IMAGE_ROOTFS}' '${DEPLOY_DIR_IMAGE}/${UBIFS_IMAGE_FILE}'
+    sudo chown $(id -u):$(id -g) '${DEPLOY_DIR_IMAGE}/${UBIFS_IMAGE_FILE}'
 }
 
 addtask ubifs_image before do_image after do_image_tools
-- 
2.20.1

